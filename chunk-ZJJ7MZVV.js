import{b as B,c as A,f as O,h as W,i as U,j as $,l as L}from"./chunk-CLZ4E3QE.js";import{a as G,b as H}from"./chunk-SDEG5XVJ.js";import{Aa as y,Ba as k,D as l,J as f,K as E,Ka as D,Oa as T,P as R,Pa as V,Qa as F,T as c,U as i,V as t,Va as M,W as I,Xa as j,a as S,ba as g,bb as N,da as m,ea as d,g as w,gb as P,i as v,ib as z,q as u,qa as n,r as p,ra as x,sa as h,ua as q,va as b,wa as C}from"./chunk-W7V33SUQ.js";import"./chunk-7CGTOI24.js";function K(s,o){if(s&1&&(i(0,"div",19),n(1),t()),s&2){let e=d();l(),x(e.error)}}function Q(s,o){s&1&&(i(0,"div",20),n(1,"Loading requests..."),t())}function X(s,o){if(s&1){let e=g();i(0,"button",23),m("click",function(){let r=u(e).$implicit,_=d(2);return p(_.selectRequest(r))}),i(1,"div",24)(2,"h3",25),n(3),t(),i(4,"span",26),n(5),t()(),i(6,"div",27)(7,"p")(8,"strong"),n(9,"Document Type:"),t(),n(10),t(),i(11,"p")(12,"strong"),n(13,"Purpose:"),t(),n(14),t(),i(15,"p")(16,"strong"),n(17,"Requested on:"),t(),n(18),y(19,"date"),t()()()}if(s&2){let e=o.$implicit,a=d(2);l(3),x(e.residentName),l(),c("ngClass",a.getStatusBadgeClass(e.status)),l(),x(a.formatStatus(e.status)),l(5),h(" ",e.documentType),l(4),h(" ",e.purpose),l(4),h(" ",k(19,6,e.requestDate))}}function Y(s,o){if(s&1&&(i(0,"div",21),R(1,X,20,8,"button",22),t()),s&2){let e=d();l(),c("ngForOf",e.filteredRequests)}}function Z(s,o){s&1&&(i(0,"div",28),n(1,"No requests found"),t())}function ee(s,o){if(s&1&&(i(0,"div",33)(1,"strong"),n(2,"Remarks:"),t(),i(3,"span"),n(4),t()()),s&2){let e=d(2);l(4),x(e.selectedRequest.remarks)}}function te(s,o){if(s&1&&(i(0,"div",33)(1,"strong"),n(2,"Revision Reason:"),t(),i(3,"span",38),n(4),t()()),s&2){let e=d(2);l(4),x(e.selectedRequest.revisionReason)}}function ie(s,o){if(s&1){let e=g();i(0,"div",39)(1,"h4",40),n(2,"Actions"),t(),i(3,"textarea",41),C("ngModelChange",function(r){u(e);let _=d(2);return b(_.remarks,r)||(_.remarks=r),p(r)}),t(),i(4,"div",42)(5,"button",43),m("click",function(){u(e);let r=d(2);return p(r.approveRequest())}),n(6,"Approve"),t(),i(7,"button",44),m("click",function(){u(e);let r=d(2);return p(r.markReadyForPickup())}),n(8,"Mark Ready"),t(),i(9,"button",45),m("click",function(){u(e);let r=d(2);return p(r.rejectRequest())}),n(10,"Reject"),t(),i(11,"button",46),m("click",function(){u(e);let r=d(2);return p(r.closeDetails())}),n(12,"Cancel"),t()()()}if(s&2){let e=d(2);l(3),q("ngModel",e.remarks)}}function ne(s,o){if(s&1){let e=g();i(0,"div",47)(1,"button",48),m("click",function(){u(e);let r=d(2);return p(r.markReadyForPickup())}),n(2,"Mark Ready for Pickup"),t(),i(3,"button",49),m("click",function(){u(e);let r=d(2);return p(r.closeDetails())}),n(4,"Close"),t()()}}function se(s,o){if(s&1){let e=g();i(0,"div",39)(1,"h4",40),n(2,"Update Status"),t(),i(3,"textarea",50),C("ngModelChange",function(r){u(e);let _=d(2);return b(_.revisionReason,r)||(_.revisionReason=r),p(r)}),t(),i(4,"div",42)(5,"button",51),m("click",function(){u(e);let r=d(2);return p(r.markCompleted())}),n(6,"Mark as Completed"),t(),i(7,"button",52),m("click",function(){u(e);let r=d(2);return p(r.markNeedsRevision())}),n(8,"Needs Revision"),t(),i(9,"button",46),m("click",function(){u(e);let r=d(2);return p(r.closeDetails())}),n(10,"Cancel"),t()()()}if(s&2){let e=d(2);l(3),q("ngModel",e.revisionReason)}}function re(s,o){if(s&1){let e=g();i(0,"div",39)(1,"button",49),m("click",function(){u(e);let r=d(2);return p(r.closeDetails())}),n(2,"Close"),t()()}}function oe(s,o){if(s&1&&(i(0,"div",29)(1,"div",30)(2,"h3",31),n(3,"Request Details"),t(),i(4,"div",32)(5,"div",33)(6,"strong"),n(7,"Resident Name:"),t(),i(8,"span"),n(9),t()(),i(10,"div",33)(11,"strong"),n(12,"Document Type:"),t(),i(13,"span"),n(14),t()(),i(15,"div",33)(16,"strong"),n(17,"Purpose:"),t(),i(18,"span"),n(19),t()(),i(20,"div",33)(21,"strong"),n(22,"Status:"),t(),i(23,"span",34),n(24),t()(),i(25,"div",33)(26,"strong"),n(27,"Requested on:"),t(),i(28,"span"),n(29),y(30,"date"),t()(),R(31,ee,5,1,"div",35)(32,te,5,1,"div",35)(33,ie,13,1,"div",36)(34,ne,5,0,"div",37)(35,se,11,1,"div",36)(36,re,3,0,"div",36),t()()()),s&2){let e=d();l(9),x(e.selectedRequest.residentName),l(5),x(e.selectedRequest.documentType),l(5),x(e.selectedRequest.purpose),l(4),c("ngClass",e.getStatusBadgeClass(e.selectedRequest.status)),l(),x(e.formatStatus(e.selectedRequest.status)),l(5),x(k(30,12,e.selectedRequest.requestDate)),l(2),c("ngIf",e.selectedRequest.remarks),l(),c("ngIf",e.selectedRequest.revisionReason),l(),c("ngIf",e.selectedRequest.status==="pending"),l(),c("ngIf",e.selectedRequest.status==="approved"),l(),c("ngIf",e.selectedRequest.status==="ready_for_pickup"),l(),c("ngIf",e.selectedRequest.status!=="pending"&&e.selectedRequest.status!=="approved"&&e.selectedRequest.status!=="ready_for_pickup")}}var J=class s{constructor(o,e,a,r){this.documentRequestService=o;this.authService=e;this.router=a;this.cdr=r}requests=[];filteredRequests=[];loading=!0;error="";selectedRequest=null;statusFilter="all";remarks="";revisionReason="";destroy$=new S;ngOnInit(){this.authService.getAuthInitialized().pipe(w(1)).subscribe(()=>{this.loadRequests()})}goBack(){this.router.navigate(["/staff"])}loadRequests(){this.loading=!0,this.documentRequestService.getAllRequests().pipe(v(this.destroy$)).subscribe({next:o=>{this.requests=o,this.filterRequests(),this.loading=!1,this.cdr?.markForCheck()},error:o=>{this.error="Failed to load requests",this.loading=!1,this.cdr?.markForCheck()}})}filterRequests(){this.statusFilter==="all"?this.filteredRequests=this.requests:this.filteredRequests=this.requests.filter(o=>o.status===this.statusFilter)}selectRequest(o){this.selectedRequest=o,this.remarks="",this.revisionReason=""}closeDetails(){this.selectedRequest=null,this.remarks="",this.revisionReason=""}approveRequest(){if(!this.selectedRequest)return;let o=this.authService.currentUserSubject.value;this.documentRequestService.approveRequest(this.selectedRequest.id,o?.uid||"unknown").pipe(v(this.destroy$)).subscribe({next:()=>{this.loadRequests(),this.closeDetails()},error:e=>{this.error="Failed to approve request"}})}markReadyForPickup(){this.selectedRequest&&this.documentRequestService.markReadyForPickup(this.selectedRequest.id).pipe(v(this.destroy$)).subscribe({next:()=>{this.loadRequests(),this.closeDetails()},error:o=>{this.error="Failed to update request"}})}rejectRequest(){if(!this.selectedRequest||!this.remarks){this.error="Please provide a reason for rejection";return}this.documentRequestService.rejectRequest(this.selectedRequest.id,this.remarks).pipe(v(this.destroy$)).subscribe({next:()=>{this.loadRequests(),this.closeDetails()},error:o=>{this.error="Failed to reject request"}})}markCompleted(){this.selectedRequest&&this.documentRequestService.markCompleted(this.selectedRequest.id).pipe(v(this.destroy$)).subscribe({next:()=>{this.loadRequests(),this.closeDetails()},error:o=>{this.error="Failed to mark as completed"}})}markNeedsRevision(){if(!this.selectedRequest||!this.revisionReason){this.error="Please provide a reason for revision";return}this.documentRequestService.markNeedsRevision(this.selectedRequest.id,this.revisionReason).pipe(v(this.destroy$)).subscribe({next:()=>{this.loadRequests(),this.closeDetails()},error:o=>{this.error="Failed to mark as needs revision"}})}getStatusBadgeClass(o){switch(o){case"pending":return"bg-yellow-400 text-black";case"approved":return"bg-green-500 text-white";case"ready_for_pickup":return"bg-teal-500 text-white";case"rejected":return"bg-red-500 text-white";case"completed":return"bg-blue-600 text-white";case"needs_revision":return"bg-orange-500 text-white";default:return"bg-gray-500 text-white"}}formatStatus(o){return o.replace(/_/g," ").toUpperCase()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(e){return new(e||s)(f(z),f(P),f(N),f(D))};static \u0275cmp=E({type:s,selectors:[["app-requests"]],decls:29,vars:6,consts:[[1,"p-6"],[1,"flex","items-center","justify-between","mb-4"],["pButton","","pRipple","","type","button","icon","pi pi-arrow-left","aria-label","Back",1,"p-button-text","p-button-sm",3,"click"],[1,"text-xl","font-semibold"],["class","mb-4 p-3 bg-red-50 text-red-700 rounded",4,"ngIf"],[1,"mb-4","flex","items-center","gap-3"],[1,"text-sm"],["id","statusFilter","aria-label","Filter document requests by status",1,"p-2","border","rounded",3,"ngModelChange","change","ngModel"],["value","all"],["value","pending"],["value","approved"],["value","ready_for_pickup"],["value","completed"],["value","needs_revision"],["value","rejected"],["class","rounded bg-white p-6 shadow",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",4,"ngIf"],["class","text-center p-8 bg-white rounded shadow",4,"ngIf"],["class","fixed inset-0 bg-black/50 flex items-center justify-center z-50",4,"ngIf"],[1,"mb-4","p-3","bg-red-50","text-red-700","rounded"],[1,"rounded","bg-white","p-6","shadow"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["type","button","class","text-left bg-white p-4 rounded shadow cursor-pointer",3,"click",4,"ngFor","ngForOf"],["type","button",1,"text-left","bg-white","p-4","rounded","shadow","cursor-pointer",3,"click"],[1,"flex","justify-between","items-start"],[1,"text-md","font-semibold"],[1,"px-2","py-1","rounded","text-sm",3,"ngClass"],[1,"text-sm","text-gray-600","mt-2"],[1,"text-center","p-8","bg-white","rounded","shadow"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50"],["role","dialog","aria-modal","true","aria-labelledby","request-details-title","aria-describedby","request-details-desc",1,"bg-white","rounded-lg","w-full","max-w-xl","p-6"],["id","request-details-title",1,"text-lg","font-semibold","mb-3"],["id","request-details-desc",1,"grid","gap-2"],[1,"flex","justify-between"],[3,"ngClass"],["class","flex justify-between",4,"ngIf"],["class","mt-4",4,"ngIf"],["class","mt-4 flex gap-2",4,"ngIf"],[1,"text-orange-600"],[1,"mt-4"],[1,"font-semibold","mb-2"],["placeholder","Add any remarks...",1,"w-full","p-2","border","rounded","mb-2",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],["type","button",1,"flex-1","px-3","py-2","bg-green-600","text-white","rounded",3,"click"],["type","button",1,"flex-1","px-3","py-2","bg-teal-500","text-white","rounded",3,"click"],["type","button",1,"flex-1","px-3","py-2","bg-red-600","text-white","rounded",3,"click"],["type","button",1,"flex-1","px-3","py-2","bg-gray-200","rounded",3,"click"],[1,"mt-4","flex","gap-2"],[1,"px-3","py-2","bg-teal-500","text-white","rounded",3,"click"],[1,"px-3","py-2","bg-gray-200","rounded",3,"click"],["placeholder","Add reason for revision (optional for completed)...",1,"w-full","p-2","border","rounded","mb-2",3,"ngModelChange","ngModel"],["type","button",1,"flex-1","px-3","py-2","bg-blue-600","text-white","rounded",3,"click"],["type","button",1,"flex-1","px-3","py-2","bg-orange-500","text-white","rounded",3,"click"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),m("click",function(){return a.goBack()}),t(),i(3,"h2",3),n(4,"Document Requests"),t(),I(5,"div"),t(),R(6,K,2,1,"div",4),i(7,"div",5)(8,"label",6),n(9,"Filter by Status:"),t(),i(10,"select",7),C("ngModelChange",function(_){return b(a.statusFilter,_)||(a.statusFilter=_),_}),m("change",function(){return a.filterRequests()}),i(11,"option",8),n(12,"All Requests"),t(),i(13,"option",9),n(14,"Pending"),t(),i(15,"option",10),n(16,"Approved"),t(),i(17,"option",11),n(18,"Ready for Pickup"),t(),i(19,"option",12),n(20,"Completed"),t(),i(21,"option",13),n(22,"Needs Revision"),t(),i(23,"option",14),n(24,"Rejected"),t()()(),R(25,Q,2,0,"div",15)(26,Y,2,1,"div",16)(27,Z,2,0,"div",17)(28,oe,37,14,"div",18),t()),e&2&&(l(6),c("ngIf",a.error),l(4),q("ngModel",a.statusFilter),l(15),c("ngIf",a.loading),l(),c("ngIf",!a.loading&&a.filteredRequests.length>0),l(),c("ngIf",!a.loading&&a.filteredRequests.length===0),l(),c("ngIf",a.selectedRequest))},dependencies:[j,T,V,F,L,U,$,B,W,A,O,H,G,M],styles:[".requests-legacy[_ngcontent-%COMP%]{--fallback: transparent}"]})};export{J as RequestsComponent};
