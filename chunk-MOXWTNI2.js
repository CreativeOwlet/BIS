import{b as D,c as F,d as P,e as N,f as I,g as L,h as q,i as j,j as G,k as Q,l as z}from"./chunk-5TDXQA3R.js";import{a as Y,b as H}from"./chunk-6IJTW5S2.js";import{D as l,J as b,K as k,Ka as V,P as y,Pa as B,Qa as W,T as h,U as i,V as n,Xa as O,a as E,ba as v,bb as T,da as f,ea as s,g as M,gb as A,hb as U,i as x,q as m,qa as r,r as c,ra as w,sa as S,ua as u,va as g,wa as _}from"./chunk-SW3RDXTT.js";import{a as R,b as C}from"./chunk-7CGTOI24.js";function K(p,a){if(p&1&&(i(0,"div",14),r(1),n()),p&2){let t=s();l(),w(t.error)}}function X(p,a){p&1&&(i(0,"div",15),r(1,"Loading residents..."),n())}function Z(p,a){if(p&1){let t=v();i(0,"tr",23)(1,"td",24),r(2),n(),i(3,"td",24),r(4),n(),i(5,"td",24),r(6),n(),i(7,"td",24),r(8),n(),i(9,"td",24),r(10),n(),i(11,"td",25)(12,"button",26),f("click",function(){let e=m(t).$implicit,d=s(2);return c(d.openEdit(e))}),r(13,"Edit"),n(),i(14,"button",27),f("click",function(){let e=m(t).$implicit,d=s(2);return c(d.deleteResident(e.id))}),r(15,"Delete"),n()()()}if(p&2){let t=a.$implicit,o=s(2);l(2),w(t.name),l(2),w(o.calculateAge(t.dateOfBirth)),l(2),w(t.address),l(2),w(t.phone),l(2),w(t.email)}}function $(p,a){if(p&1){let t=v();i(0,"div",28)(1,"div",29)(2,"div",30),r(3),n(),i(4,"div",31),r(5),n()(),i(6,"div",32)(7,"span",33),r(8,"Address:"),n(),r(9),n(),i(10,"div",32)(11,"span",33),r(12,"Phone:"),n(),r(13),n(),i(14,"div",32)(15,"span",33),r(16,"Email:"),n(),r(17),n(),i(18,"div",34)(19,"button",35),f("click",function(){let e=m(t).$implicit,d=s(2);return c(d.openEdit(e))}),r(20,"Edit"),n(),i(21,"button",36),f("click",function(){let e=m(t).$implicit,d=s(2);return c(d.deleteResident(e.id))}),r(22,"Delete"),n()()()}if(p&2){let t=a.$implicit,o=s(2);l(3),w(t.name),l(2),S("Age: ",o.calculateAge(t.dateOfBirth)),l(4),S(" ",t.address),l(4),S(" ",t.phone),l(4),S(" ",t.email)}}function ee(p,a){if(p&1&&(i(0,"div")(1,"div",16)(2,"table",17)(3,"thead",18)(4,"tr")(5,"th",19),r(6,"Name"),n(),i(7,"th",19),r(8,"Age"),n(),i(9,"th",19),r(10,"Address"),n(),i(11,"th",19),r(12,"Phone"),n(),i(13,"th",19),r(14,"Email"),n(),i(15,"th",19),r(16,"Actions"),n()()(),i(17,"tbody"),y(18,Z,16,5,"tr",20),n()()(),i(19,"div",21),y(20,$,23,5,"div",22),n()()),p&2){let t=s();l(18),h("ngForOf",t.residents),l(2),h("ngForOf",t.residents)}}function te(p,a){p&1&&(i(0,"div",37),r(1,"No residents found"),n())}function ie(p,a){if(p&1){let t=v();i(0,"div",38)(1,"div",39),f("click",function(e){return m(t),c(e.stopPropagation())}),i(2,"h3",40),r(3,"Add New Resident"),n(),i(4,"form",41),f("ngSubmit",function(){m(t);let e=s();return c(e.addResident())}),i(5,"div")(6,"label",42),r(7,"Full Name:"),n(),i(8,"input",43),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.name,e)||(d.newResident.name=e),c(e)}),n()(),i(9,"div")(10,"label",44),r(11,"Date of Birth:"),n(),i(12,"input",45),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.dateOfBirth,e)||(d.newResident.dateOfBirth=e),c(e)}),n()(),i(13,"div")(14,"label",46),r(15,"Gender:"),n(),i(16,"select",47),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.gender,e)||(d.newResident.gender=e),c(e)}),i(17,"option",48),r(18,"Male"),n(),i(19,"option",49),r(20,"Female"),n(),i(21,"option",50),r(22,"Other"),n()()(),i(23,"div")(24,"label",51),r(25,"Address:"),n(),i(26,"input",52),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.address,e)||(d.newResident.address=e),c(e)}),n()(),i(27,"div")(28,"label",53),r(29,"Barangay:"),n(),i(30,"input",54),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.barangay,e)||(d.newResident.barangay=e),c(e)}),n()(),i(31,"div")(32,"label",55),r(33,"Phone:"),n(),i(34,"input",56),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.phone,e)||(d.newResident.phone=e),c(e)}),n()(),i(35,"div")(36,"label",57),r(37,"Email:"),n(),i(38,"input",58),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.email,e)||(d.newResident.email=e),c(e)}),n()(),i(39,"div")(40,"label",59),r(41,"Civil Status:"),n(),i(42,"select",60),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.civilStatus,e)||(d.newResident.civilStatus=e),c(e)}),i(43,"option",61),r(44,"Single"),n(),i(45,"option",62),r(46,"Married"),n(),i(47,"option",63),r(48,"Widowed"),n(),i(49,"option",64),r(50,"Divorced"),n()()(),i(51,"div")(52,"label",65),r(53,"Occupation:"),n(),i(54,"input",66),_("ngModelChange",function(e){m(t);let d=s();return g(d.newResident.occupation,e)||(d.newResident.occupation=e),c(e)}),n()(),i(55,"div",67)(56,"button",68),r(57,"Add Resident"),n(),i(58,"button",69),f("click",function(){m(t);let e=s();return c(e.closeAddForm())}),r(59,"Cancel"),n()()()()()}if(p&2){let t=s();l(8),u("ngModel",t.newResident.name),l(4),u("ngModel",t.newResident.dateOfBirth),l(4),u("ngModel",t.newResident.gender),l(10),u("ngModel",t.newResident.address),l(4),u("ngModel",t.newResident.barangay),l(4),u("ngModel",t.newResident.phone),l(4),u("ngModel",t.newResident.email),l(4),u("ngModel",t.newResident.civilStatus),l(12),u("ngModel",t.newResident.occupation)}}function ne(p,a){if(p&1){let t=v();i(0,"div",38)(1,"div",70),f("click",function(e){return m(t),c(e.stopPropagation())}),i(2,"h3",71),r(3,"Edit Resident"),n(),i(4,"form",41),f("ngSubmit",function(){m(t);let e=s();return c(e.saveEdit())}),i(5,"div")(6,"label",72),r(7,"Full Name:"),n(),i(8,"input",73),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.name,e)||(d.selectedResident.name=e),c(e)}),n()(),i(9,"div")(10,"label",74),r(11,"Date of Birth:"),n(),i(12,"input",75),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.dateOfBirth,e)||(d.selectedResident.dateOfBirth=e),c(e)}),n()(),i(13,"div")(14,"label",76),r(15,"Gender:"),n(),i(16,"select",77),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.gender,e)||(d.selectedResident.gender=e),c(e)}),i(17,"option",48),r(18,"Male"),n(),i(19,"option",49),r(20,"Female"),n(),i(21,"option",50),r(22,"Other"),n()()(),i(23,"div")(24,"label",78),r(25,"Address:"),n(),i(26,"input",79),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.address,e)||(d.selectedResident.address=e),c(e)}),n()(),i(27,"div")(28,"label",80),r(29,"Barangay:"),n(),i(30,"input",81),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.barangay,e)||(d.selectedResident.barangay=e),c(e)}),n()(),i(31,"div")(32,"label",82),r(33,"Phone:"),n(),i(34,"input",83),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.phone,e)||(d.selectedResident.phone=e),c(e)}),n()(),i(35,"div")(36,"label",84),r(37,"Email:"),n(),i(38,"input",85),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.email,e)||(d.selectedResident.email=e),c(e)}),n()(),i(39,"div")(40,"label",86),r(41,"Civil Status:"),n(),i(42,"select",87),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.civilStatus,e)||(d.selectedResident.civilStatus=e),c(e)}),i(43,"option",61),r(44,"Single"),n(),i(45,"option",62),r(46,"Married"),n(),i(47,"option",63),r(48,"Widowed"),n(),i(49,"option",64),r(50,"Divorced"),n()()(),i(51,"div")(52,"label",88),r(53,"Occupation:"),n(),i(54,"input",89),_("ngModelChange",function(e){m(t);let d=s();return g(d.selectedResident.occupation,e)||(d.selectedResident.occupation=e),c(e)}),n()(),i(55,"div",67)(56,"button",68),r(57,"Save Changes"),n(),i(58,"button",69),f("click",function(){m(t);let e=s();return c(e.closeEdit())}),r(59,"Cancel"),n()()()()()}if(p&2){let t=s();l(8),u("ngModel",t.selectedResident.name),l(4),u("ngModel",t.selectedResident.dateOfBirth),l(4),u("ngModel",t.selectedResident.gender),l(10),u("ngModel",t.selectedResident.address),l(4),u("ngModel",t.selectedResident.barangay),l(4),u("ngModel",t.selectedResident.phone),l(4),u("ngModel",t.selectedResident.email),l(4),u("ngModel",t.selectedResident.civilStatus),l(12),u("ngModel",t.selectedResident.occupation)}}var J=class p{constructor(a,t,o,e){this.residentService=a;this.authService=t;this.router=o;this.cdr=e}residents=[];loading=!0;error="";showAddForm=!1;selectedResident=null;searchQuery="";destroy$=new E;newResident={name:"",dateOfBirth:"",gender:"male",address:"",barangay:"",phone:"",email:"",civilStatus:"single",occupation:""};ngOnInit(){this.authService.getAuthInitialized().pipe(M(1)).subscribe(()=>{this.loadResidents()})}goBack(){this.router.navigate(["/staff"])}loadResidents(){this.loading=!0,this.residentService.getAllResidents().pipe(x(this.destroy$)).subscribe({next:a=>{this.residents=a,this.loading=!1,this.cdr?.markForCheck()},error:a=>{this.error="Failed to load residents",this.loading=!1,this.cdr?.markForCheck()}})}searchResidents(){if(!this.searchQuery){this.loadResidents();return}this.residentService.searchResidents(this.searchQuery).pipe(x(this.destroy$)).subscribe({next:a=>{this.residents=a},error:a=>{this.error="Search failed"}})}openAddForm(){this.showAddForm=!0}closeAddForm(){this.showAddForm=!1,this.resetForm()}resetForm(){this.newResident={name:"",dateOfBirth:"",gender:"male",address:"",barangay:"",phone:"",email:"",civilStatus:"single",occupation:""}}openEdit(a){let t="";if(a.dateOfBirth){let o;if(typeof a.dateOfBirth=="object"&&typeof a.dateOfBirth.toDate=="function"?o=a.dateOfBirth.toDate():typeof a.dateOfBirth=="number"?o=new Date(a.dateOfBirth):o=new Date(a.dateOfBirth),!isNaN(o.getTime())){let e=(o.getMonth()+1).toString().padStart(2,"0"),d=o.getDate().toString().padStart(2,"0");t=`${o.getFullYear()}-${e}-${d}`}}this.selectedResident=C(R({},a),{dateOfBirth:t})}closeEdit(){this.selectedResident=null}saveEdit(){if(!this.selectedResident||!this.selectedResident.id){this.error="No resident selected for editing.";return}let a=this.selectedResident.id,t;if(this.selectedResident.dateOfBirth){let e=new Date(this.selectedResident.dateOfBirth);isNaN(e.getTime())?t=void 0:t=e}let o=C(R({name:this.selectedResident.name},t?{dateOfBirth:t}:{}),{gender:this.selectedResident.gender,address:this.selectedResident.address,barangay:this.selectedResident.barangay,phone:this.selectedResident.phone,email:this.selectedResident.email,civilStatus:this.selectedResident.civilStatus,occupation:this.selectedResident.occupation,updatedAt:new Date});this.residentService.updateResident(a,o).pipe(M(1)).subscribe({next:()=>{this.closeEdit(),this.loadResidents()},error:e=>{console.error("Failed to update resident",e),this.error="Failed to update resident."}})}addResident(){if(!this.newResident.name||!this.newResident.email){this.error="Name and email are required";return}let a=this.authService.currentUserSubject.value,t=C(R({},this.newResident),{dateOfBirth:new Date(this.newResident.dateOfBirth),createdAt:new Date,updatedAt:new Date,createdBy:a?.uid||"unknown"});this.residentService.addResident(t).pipe(x(this.destroy$)).subscribe({next:()=>{this.closeAddForm(),this.loadResidents()},error:o=>{this.error="Failed to add resident"}})}deleteResident(a){confirm("Are you sure you want to delete this resident?")&&this.residentService.deleteResident(a).pipe(x(this.destroy$)).subscribe({next:()=>{this.loadResidents()},error:t=>{this.error="Failed to delete resident"}})}calculateAge(a){if(!a)return 0;let t;try{typeof a=="object"&&typeof a.toDate=="function"?t=a.toDate():typeof a=="number"?t=new Date(a):t=new Date(a)}catch{return 0}if(isNaN(t.getTime()))return 0;let o=new Date,e=o.getFullYear()-t.getFullYear(),d=o.getMonth()-t.getMonth();return(d<0||d===0&&o.getDate()<t.getDate())&&e--,e}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(t){return new(t||p)(b(U),b(A),b(T),b(V))};static \u0275cmp=k({type:p,selectors:[["app-residents"]],decls:18,vars:7,consts:[[1,"p-6"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","mb-4"],[1,"flex","gap-2","w-full","sm:w-auto"],["pButton","","pRipple","","type","button","icon","pi pi-arrow-left","aria-label","Back",1,"p-button-text","p-button-sm",3,"click"],[1,"text-xl","font-semibold","flex-1","text-center","sm:text-left"],["type","button",1,"hidden","sm:inline-block","sm:w-auto","px-4","py-2","rounded","bg-indigo-600","text-white","font-medium","hover:bg-indigo-700",3,"click"],["type","button",1,"fixed","bottom-0","left-0","right-0","z-40","w-full","sm:hidden","px-4","py-3","bg-indigo-600","text-white","font-medium","text-lg","rounded-none","shadow-lg",3,"click"],["class","mb-4 p-3 bg-red-50 text-red-700 rounded",4,"ngIf"],[1,"mb-4"],["type","text","placeholder","Search residents by name...",1,"w-full","md:w-1/2","p-2","border","rounded",3,"ngModelChange","keyup","ngModel"],["class","rounded bg-white p-6 shadow",4,"ngIf"],[4,"ngIf"],["class","text-center p-8 bg-white rounded shadow",4,"ngIf"],["class","fixed inset-0 bg-black/50 flex items-center justify-center z-50",4,"ngIf"],[1,"mb-4","p-3","bg-red-50","text-red-700","rounded"],[1,"rounded","bg-white","p-6","shadow"],[1,"hidden","md:block","bg-white","rounded","shadow","overflow-x-auto"],[1,"w-full","min-w-[700px]","table-auto"],[1,"bg-gray-100"],[1,"p-3","text-left"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"md:hidden","flex","flex-col","gap-4"],["class","bg-white rounded shadow p-4 flex flex-col gap-2",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],[1,"p-3"],[1,"p-3","flex","gap-2"],["type","button",1,"px-2","py-1","bg-teal-500","text-white","rounded",3,"click"],[1,"px-2","py-1","bg-red-500","text-white","rounded",3,"click"],[1,"bg-white","rounded","shadow","p-4","flex","flex-col","gap-2"],[1,"flex","flex-col","gap-1","sm:flex-row","sm:items-center","sm:justify-between"],[1,"font-semibold","text-base"],[1,"text-xs","text-gray-500"],[1,"text-sm","text-gray-700"],[1,"font-medium"],[1,"flex","flex-col","gap-2","mt-2","sm:flex-row"],["type","button",1,"w-full","px-3","py-2","bg-teal-500","text-white","rounded",3,"click"],[1,"w-full","px-3","py-2","bg-red-500","text-white","rounded",3,"click"],[1,"text-center","p-8","bg-white","rounded","shadow"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50"],["role","dialog","aria-modal","true","aria-labelledby","add-resident-title",1,"bg-white","rounded-lg","w-full","max-w-lg","p-6",3,"click"],["id","add-resident-title",1,"text-lg","font-semibold","mb-3"],[1,"space-y-3",3,"ngSubmit"],["for","addName",1,"block","mb-1","font-medium"],["id","addName","name","addName","required","","placeholder","Full name",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","addDateOfBirth",1,"block","mb-1","font-medium"],["type","date","id","addDateOfBirth","name","addDateOfBirth","required","",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","addGender",1,"block","mb-1","font-medium"],["id","addGender","name","addGender",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["value","male"],["value","female"],["value","other"],["for","addAddress",1,"block","mb-1","font-medium"],["id","addAddress","name","addAddress","required","","placeholder","Address",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","addBarangay",1,"block","mb-1","font-medium"],["id","addBarangay","name","addBarangay","required","","placeholder","Barangay",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","addPhone",1,"block","mb-1","font-medium"],["id","addPhone","name","addPhone","required","","placeholder","Phone",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","addEmail",1,"block","mb-1","font-medium"],["type","email","id","addEmail","name","addEmail","required","","placeholder","Email",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","addCivilStatus",1,"block","mb-1","font-medium"],["id","addCivilStatus","name","addCivilStatus",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["value","single"],["value","married"],["value","widowed"],["value","divorced"],["for","addOccupation",1,"block","mb-1","font-medium"],["id","addOccupation","name","addOccupation","placeholder","Occupation",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],[1,"flex","gap-2","justify-end","mt-3"],["type","submit",1,"px-3","py-2","bg-indigo-600","text-white","rounded"],["type","button",1,"px-3","py-2","bg-gray-200","rounded",3,"click"],["role","dialog","aria-modal","true","aria-labelledby","edit-resident-title",1,"bg-white","rounded-lg","w-full","max-w-lg","p-6",3,"click"],["id","edit-resident-title",1,"text-lg","font-semibold","mb-3"],["for","editName",1,"block","mb-1","font-medium"],["id","editName","name","editName","required","","placeholder","Full name",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editDateOfBirth",1,"block","mb-1","font-medium"],["type","date","id","editDateOfBirth","name","editDateOfBirth","required","",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editGender",1,"block","mb-1","font-medium"],["id","editGender","name","editGender",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editAddress",1,"block","mb-1","font-medium"],["id","editAddress","name","editAddress","required","","placeholder","Address",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editBarangay",1,"block","mb-1","font-medium"],["id","editBarangay","name","editBarangay","required","","placeholder","Barangay",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editPhone",1,"block","mb-1","font-medium"],["id","editPhone","name","editPhone","required","","placeholder","Phone",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editEmail",1,"block","mb-1","font-medium"],["type","email","id","editEmail","name","editEmail","required","","placeholder","Email",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editCivilStatus",1,"block","mb-1","font-medium"],["id","editCivilStatus","name","editCivilStatus",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"],["for","editOccupation",1,"block","mb-1","font-medium"],["id","editOccupation","name","editOccupation","placeholder","Occupation",1,"w-full","p-2","border","rounded",3,"ngModelChange","ngModel"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),f("click",function(){return o.goBack()}),n(),i(4,"h2",4),r(5,"Resident Management"),n()(),i(6,"button",5),f("click",function(){return o.openAddForm()}),r(7,"+ Add New Resident"),n(),i(8,"button",6),f("click",function(){return o.openAddForm()}),r(9,"+ Add New Resident"),n()(),y(10,K,2,1,"div",7),i(11,"div",8)(12,"input",9),_("ngModelChange",function(d){return g(o.searchQuery,d)||(o.searchQuery=d),d}),f("keyup",function(){return o.searchResidents()}),n()(),y(13,X,2,0,"div",10)(14,ee,21,2,"div",11)(15,te,2,0,"div",12)(16,ie,60,9,"div",13)(17,ne,60,9,"div",13),n()),t&2&&(l(10),h("ngIf",o.error),l(2),u("ngModel",o.searchQuery),l(),h("ngIf",o.loading),l(),h("ngIf",!o.loading&&o.residents.length>0),l(),h("ngIf",!o.loading&&o.residents.length===0),l(),h("ngIf",o.showAddForm),l(),h("ngIf",o.selectedResident))},dependencies:[O,B,W,z,L,j,G,D,q,F,P,Q,I,N,H,Y],styles:[".residents-legacy[_ngcontent-%COMP%]{--fallback: transparent}"]})};export{J as ResidentsComponent};
